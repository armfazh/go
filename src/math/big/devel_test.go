// Copyright 2009 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

package big

import (
	//	"fmt"
	"testing"
	//	"testing/quick"
)

var devel_expTests = []struct {
	x, y, m string
	out     string
}{
	// y <= 0
	{"0", "0", "", "1"},
	{"1", "0", "", "1"},
	{"-10", "0", "", "1"},
	{"1234", "-1", "", "1"},

	// m == 1
	{"0", "0", "1", "0"},
	{"1", "0", "1", "0"},
	{"-10", "0", "1", "0"},
	{"1234", "-1", "1", "0"},

	// misc
	{"5", "1", "3", "2"},
	{"5", "-7", "", "1"},
	{"-5", "-7", "", "1"},
	{"5", "0", "", "1"},
	{"-5", "0", "", "1"},
	{"5", "1", "", "5"},
	{"-5", "1", "", "-5"},
	{"-5", "1", "7", "2"},
	{"-2", "3", "2", "0"},
	{"5", "2", "", "25"},
	{"1", "65537", "2", "1"},
	{"0x8000000000000000", "2", "", "0x40000000000000000000000000000000"},
	{"0x8000000000000000", "2", "6719", "4944"},
	{"0x8000000000000000", "3", "6719", "5447"},
	{"0x8000000000000000", "1000", "6719", "1603"},
	{"0x8000000000000000", "1000000", "6719", "3199"},
	{"0x8000000000000000", "-1000000", "6719", "1"},

	{"0xffffffffffffffffffffffffffffffff", "0x12345678123456781234567812345678123456789", "0x01112222333344445555666677778889", "0x36168FA1DB3AAE6C8CE647E137F97A"},

	{
		"2938462938472983472983659726349017249287491026512746239764525612965293865296239471239874193284792387498274256129746192347",
		"298472983472983471903246121093472394872319615612417471234712061",
		"29834729834729834729347290846729561262544958723956495615629569234729836259263598127342374289365912465901365498236492183464",
		"23537740700184054162508175125554701713153216681790245129157191391322321508055833908509185839069455749219131480588829346291",
	},
	// test case for issue 8822
	{
		"11001289118363089646017359372117963499250546375269047542777928006103246876688756735760905680604646624353196869572752623285140408755420374049317646428185270079555372763503115646054602867593662923894140940837479507194934267532831694565516466765025434902348314525627418515646588160955862839022051353653052947073136084780742729727874803457643848197499548297570026926927502505634297079527299004267769780768565695459945235586892627059178884998772989397505061206395455591503771677500931269477503508150175717121828518985901959919560700853226255420793148986854391552859459511723547532575574664944815966793196961286234040892865",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73",
		"21484252197776302499639938883777710321993113097987201050501182909581359357618579566746556372589385361683610524730509041328855066514963385522570894839035884713051640171474186548713546686476761306436434146475140156284389181808675016576845833340494848283681088886584219750554408060556769486628029028720727393293111678826356480455433909233520504112074401376133077150471237549474149190242010469539006449596611576612573955754349042329130631128234637924786466585703488460540228477440853493392086251021228087076124706778899179648655221663765993962724699135217212118535057766739392069738618682722216712319320435674779146070442",
	},
	{
		"-0x1BCE04427D8032319A89E5C4136456671AC620883F2C4139E57F91307C485AD2D6204F4F87A58262652DB5DBBAC72B0613E51B835E7153BEC6068F5C8D696B74DBD18FEC316AEF73985CF0475663208EB46B4F17DD9DA55367B03323E5491A70997B90C059FB34809E6EE55BCFBD5F2F52233BFE62E6AA9E4E26A1D4C2439883D14F2633D55D8AA66A1ACD5595E778AC3A280517F1157989E70C1A437B849F1877B779CC3CDDEDE2DAA6594A6C66D181A00A5F777EE60596D8773998F6E988DEAE4CCA60E4DDCF9590543C89F74F603259FCAD71660D30294FBBE6490300F78A9D63FA660DC9417B8B9DDA28BEB3977B621B988E23D4D954F322C3540541BC649ABD504C50FADFD9F0987D58A2BF689313A285E773FF02899A6EF887D1D4A0D2",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73",
		"21484252197776302499639938883777710321993113097987201050501182909581359357618579566746556372589385361683610524730509041328855066514963385522570894839035884713051640171474186548713546686476761306436434146475140156284389181808675016576845833340494848283681088886584219750554408060556769486628029028720727393293111678826356480455433909233520504112074401376133077150471237549474149190242010469539006449596611576612573955754349042329130631128234637924786466585703488460540228477440853493392086251021228087076124706778899179648655221663765993962724699135217212118535057766739392069738618682722216712319320435674779146070442",
	},

	// test cases for issue 13907
	{"0xffffffff00000001", "0xffffffff00000001", "0xffffffff00000001", "0"},
	{"0xffffffffffffffff00000001", "0xffffffffffffffff00000001", "0xffffffffffffffff00000001", "0"},
	{"0xffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffff00000001", "0"},
	{"0xffffffffffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffffffffffff00000001", "0"},

	{
		"2",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73", // odd
		"0x6AADD3E3E424D5B713FCAA8D8945B1E055166132038C57BBD2D51C833F0C5EA2007A2324CE514F8E8C2F008A2F36F44005A4039CB55830986F734C93DAF0EB4BAB54A6A8C7081864F44346E9BC6F0A3EB9F2C0146A00C6A05187D0C101E1F2D038CDB70CB5E9E05A2D188AB6CBB46286624D4415E7D4DBFAD3BCC6009D915C406EED38F468B940F41E6BEDC0430DD78E6F19A7DA3A27498A4181E24D738B0072D8F6ADB8C9809A5B033A09785814FD9919F6EF9F83EEA519BEC593855C4C10CBEEC582D4AE0792158823B0275E6AEC35242740468FAF3D5C60FD1E376362B6322F78B7ED0CA1C5BBCD2B49734A56C0967A1D01A100932C837B91D592CE08ABFF",
	},
	{
		"2",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF72", // even
		"0x7858794B5897C29F4ED0B40913416AB6C48588484E6A45F2ED3E26C941D878E923575AAC434EE2750E6439A6976F9BB4D64CEDB2A53CE8D04DD48CADCDF8E46F22747C6B81C6CEA86C0D873FBF7CEF262BAAC43A522BD7F32F3CDAC52B9337C77B3DCFB3DB3EDD80476331E82F4B1DF8EFDC1220C92656DFC9197BDC1877804E28D928A2A284B8DED506CBA304435C9D0133C246C98A7D890D1DE60CBC53A024361DA83A9B8775019083D22AC6820ED7C3C68F8E801DD4EC779EE0A05C6EB682EF9840D285B838369BA7E148FA27691D524FAEAF7C6ECE2A4B99A294B9F2C241857B5B90CC8BFFCFCF18DFA7D676131D5CD3855A5A3E8EBFA0CDFADB4D198B4A",
	},
	{ // 512-bit exponentiation odd-modulus
		"0x7eff18a9ca2d7e30de92f3ad18f62b86f34b3bac9d31b59d15b7decb5f0f20b8a9812fb4e717dbfad8cbbe958a7ff3f52c6f77daa8a8f3b75edccc46410cd9c3",
		"0x24e1480a92a7a6f539fe22fd1ee7239febc2bcbd0f75244e68b1a98f49b58db3ddba8fb2a715d90d73946f07a5fc07b3d9e1b2e72b1c916388711b85d8bcf828",
		"0x618501870bb5d2820e9f2125fb74421667484fa20a1521b3f354f5b784270de8198d2941dd2a63ccefba85c4ab9a720ee51581cff567c0c413f44528f56f3b73",
		"0x22e618b966f89a90fd8584f19c2039098395d26061a2c75c44f64a7e2f3e219122f509ac137262aa9264177f74249fd973774d945e53f48fc7bc627d44c99559",
	},
	{ // 1024-bit exponentiation odd-modulus
		"0x1d7aa318d993dbde8d7d3c2718bde532caca727b3e2b889dbc024200a6ed0f68dd693de107d28cd8f345f04d15a42ba3c18b8fe7bd7b82edb814da79c8514eeda640d2ca52def2b3fa1bbce6dd6e8f3e0a391cb153fc0395925ced7fb75793351d1dc9b7aab10c161372dd671cead4c4ec6a73f1aa12f68cb2192d28cff31a35",
		"0x7498082950911d7529c7cb6f0bee4c189935aa3c6707d58c66634cca5954627375b685eee2ae206c02b1949dd616a95d6dd2295e3dc153eb424c1c5978602a0c7e38d74664a260fd82d564c1c326d692b784184dbbc01af48ed19f88f147efea34cbd481d5daf8706c56c741ddfc37791a7b9eb9495b923b4cd7b3a588fe5950",
		"0x49f5c8ab2cd9f069d04b96d73cbdf6f22fac3ec359bf60dbf8feb51eda5d511fd633a1133e59ad20a958d9449bb37015dc24eca6e4d84cf261578025ca3d436daf41652207c885ddb4f7c7542f78fdec35b6f1bf416184f9570a5c584cec443a0ee1a082f9cc5009bd101d7adf299cded7198fe5ad994e49833086b6310c6e71",
		"0x3ceb6fd2c5db73761fc724472a629fea9d2d9427e6c8292c8fb96abba1146e96700cce812b5fcbf64e61fd84251d8a977408cd0ab52bccd0443d830908e674ac8af8da8c6ab62f4b7f9c0e35c6ce8cd3124f2c2ede576e53c218b4d473389a003e10b8d6e7ffe2c791c9e282ee3860580edebc82bdd9d96dbd021678e62b2ef",
	},
	{ // 1536-bit exponentiation odd-modulus
		"0x3c6660449b9b18efdb4074f79b5dc9f4857cf51c11d368fef869c38c1da1d3ddca0aa22fd4cc23b0cad38afefff971de8122160c1f63991f178815e23172fd03dd21382646b9e88fa2814cc54c9aba2bae65b4d0f37ada2d32c068ebd8004d8e063280f40fda85a4f0f85e9feb0ee5e9bfd74a02781784e7c0c047f35d45a6c43de101d691b7d38af938470fe9e4eeb612785e98c10545e3e4f0a8617425d8f946c2660fd539ac1790a150452f26ff757385822a7d666f618d7e074cf546fcec",
		"0x1928f980bfc3f44c7cc3c9bd511e8a97c2a320178c7bc0c288355bcbfe665bae575e99fd5fecc5ab6b0865a62e9893e3c087102072ad083e897909c8526e0e133bd21612c83d45b9c6bafac883e6e0ab05ed031b0673191b65c66140760686f120a147dd0ccf58e04ff2b467149a0d7e03e067dbee7c82d70743565cfe484db9dfa26a2f451a4545ba037a559ae5581777c9d7fed5307f9fa52d39629aa2737a4d19ad8fb7e56114fc7cac89e2b154905863f3afb41de2460661368cf25e4458",
		"0xfbc01e5d3ed3a514218330b5b036d76f7ed4dc15cc86475e0c2414c644d6a689fc7f5e6269d4047e7d0ffe4ecf40fc70e94481aa257877ec9d891ac90097d0174b9a232f78b813966b5070e92d8cc2d0228deea1803a3580d087647c9f9ac09fd1ed39f09b77d9ca18ba6105b12acc6e174c3eeba9f77d8a9c98756d051ce1ae013f687e1f17ce5e45b704324109540c914ea163f75790ecae1f1a3d6e6e21cd718bfc5a90088dafe858eee6c71440b1fe613d792af9e30b6e01a758cab2be13",
		"0xe6769f71eb4168b55f6a1e0ae0c9e572c215f1b7bc3c283f11459bbe67f61bd06ae59085ef9bd77e6cc7247f387c5faa3218e3aa683407e2f27e7a36631841e8e96c676e2d9db8ffb17248d70689c2f45cde0ca27fa20b06bcf3b5020d9544e1d3acefc5200ae0a580d90e63ab1db7f742129411a95d513b568da33404528e536b756d781bd6e0e927a0e591666a32028bc3b72ee292dd444c54e6a6164dbb83eca54bffe0dd2664e9d3236f0e8f6135600e4570ad691cea0a6506df70a55b54",
	},
	{ // 2048-bit exponentiation odd-modulus
		"0x5c8fdc7fcf0a2de9b0855448af24e524050e298249d8acfd7ebf9ba8c10f11d1830c159229c72bab00bc38084c5505e41abc35d0357ad48baadab0a01bf359829462769dd4afb6c36021d045e73c188e25e25a781ba395a7299faf4dd73b20f71a9e923822e4952cf1164723bbaf2af2f07a7a466c19fe481a5640d1539352f90df7e47204e5ba2226d6b59688c6dba91b5032d45ea20df648902d9143502607bf87c47a244056d72a458fbceef751ac1c121aca99f2e221bb5869b81237a15e7cdf21247825415502a7ad5856ee5821051074eb5595de37d6826e7df43e2a5640d404078de62fedcd75e6d1dff62e407f6b0c96da26bddf289d0350af29836f",
		"0xa4d1ce5195ce776cc4d5d7f26bed09cc4d1273090ca3e2508e0fa941a0c638ab64f6c32815dc465e933db6861fcee1892da1fbf3fced3a8fce5ea5e3abbdc58085aa28e3ae965396c2f0dfa37cc5a4cfed3033a0e4f5122309bcff294837e519a4bd08e210e6cdb90ca0d422457f710f52eb01d639b40525d62ab19d694c487904ead31d5d174aea384998f034d43f8eef4873962f732f96f92a6b9411ea0aaa59e86e613633c6e11ae9440a57a0063579e6fc00fec63d24fb62678fc1d1f561d4d5483808820db505dedd3d81af0e56fb3576c416b7259af6963be24a2df225ed2f30ee186edeb8f3a3539f6c3fa609435eb2d899cc18ffb55796f88a4008fa",
		"0x7824aad0078b351d898492ce8ada3a277ff0939086686d09349aa0f9d57dc03b7c1e907e90f49e191260f4cab6b1b1e4e74948a5abbf61da9a20662cb80a5d7a2f2675d7900698bd685a3bfba9b4655fa8713ecec5565e20e63a8ebcb63cc3bf84817fdb3a6e62790d93a8070fcb70b4fd74aeef42f52ecdda018e6310fcc6a8d4ec4895a5a9585cb5363972a6d19f81d76a59508727a885d0c0449ee5b141083a00160892ea6802b63d9d6ad7f247da67aecf690983639b57419cafe570ed94b1275011af5bd82ce3d5e798079717dfaedabce4ec362a470f43e6c2fb5c859d62ccf4fcc9d9b3b90892328f0a07ed9eddf5e97b55d2e27b0a849c54af790c5d",
		"0x1a036bbe6991c899d4e7ec2e625505e5e8dcc5f794398b7ceff87d7218bb4720c92d506c0e57a92f1b00810580ed383a393a73edb3a0aa1d64a40e9b0f3a25729d463d6cd070387484b38da5aedfe234f5ea8e174efa6d3057d94e531ccc93595cfde5b55336a5cd7b4f81ac07da4375929b72dd180ee634eb07048cbf8314398edc4157db2ffba00c0d0ed8d158b25860452150a7262279d9dea7cb3c8d77b8825ef3270372219206d1add301af692dd1b150ae5e2233f8ffd56b3e9524308daeb181e24d8facbf97c5dde870e9384322c4c99582f05146a2af4f9a1c5c9248427ad82fa6b4b5f854d168357c7b6b9d09b0b8137cac432af2bde0d1c9f2314d",
	},
}

func TestFazExp(t *testing.T) {
	for i, test := range devel_expTests {
		x, ok1 := new(Int).SetString(test.x, 0)
		y, ok2 := new(Int).SetString(test.y, 0)
		out, ok3 := new(Int).SetString(test.out, 0)

		var ok4 bool
		var m *Int

		if len(test.m) == 0 {
			m, ok4 = nil, true
		} else {
			m, ok4 = new(Int).SetString(test.m, 0)
		}

		if !ok1 || !ok2 || !ok3 || !ok4 {
			t.Errorf("#%d: error in input", i)
			continue
		}

		z1 := new(Int).Exp(x, y, m)
		if !isNormalized(z1) {
			t.Errorf("#%d: %v is not normalized", i, *z1)
		}
		if z1.Cmp(out) != 0 {
			t.Errorf("#%d: got %x want %x", i, z1, out)
		}

		if m == nil {
			// The result should be the same as for m == 0;
			// specifically, there should be no div-zero panic.
			m = &Int{abs: nat{}} // m != nil && len(m.abs) == 0
			z2 := new(Int).Exp(x, y, m)
			if z2.Cmp(z1) != 0 {
				t.Errorf("#%d: got %x want %x", i, z2, z1)
			}
		}
	}
}
