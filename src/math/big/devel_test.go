// Copyright 2009 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// @author Armando Faz

package big

import (
	"internal/cpu"
	"math/rand"
	"testing"
	"time"
)

type intmult func([]Word, []Word, []Word)
type montRed func([]Word, []Word, Word) Word
type gen_value func() Word

func testIntMult(t *testing.T, f intmult, sizes []int, value gen_value) {

	for i, x_len := range sizes {
		for j, y_len := range sizes {
			x := nat(nil).make(x_len)
			y := nat(nil).make(y_len)
			for t, _ := range x {
				x[t] = value()
			}

			for t, _ := range y {
				y[t] = value()
			}
			got := nat(nil).make(x_len + y_len)
			f(got, x, y)
			got = got.norm()

			want := nat(nil).mul(x, y)
			if got.cmp(want) != 0 {
				t.Errorf("#(%d,%d) got %s want %s", i, j, got.utoa(16), want.utoa(16))
				t.Errorf("X= %s\n Y= %s\n", x.utoa(16), y.utoa(16))
				t.Errorf("lX= %d\n lY= %d\n", len(x), len(y))
				return
			}
		}
	}
}

func TestIntMult(t *testing.T) {
	r := rand.New(rand.NewSource(int64(time.Now().UnixNano())))
	values := []gen_value{
		func() Word { return 0 },
		func() Word { return 1 },
		func() Word { return (1 << _W) - 1 },
		func() Word { return Word(r.Uint64()) },
	}

	length := make([]int, 64)
	for i, _ := range length {
		length[i] = i
	}

	for _, value := range values {
		testIntMult(t, intmult_mulq, length, value)
		if cpu.X86.HasBMI2 {
			testIntMult(t, intmult_mulx, length, value)
		}
		if cpu.X86.HasBMI2 && cpu.X86.HasADX {
			testIntMult(t, intmult_mulx_adx, length, value)
		}
	}
}

var setOfPrimes = []string{
	"0x6eee117fbc7e1f9d",
	"0xcd16c4c3356e1a2005fbeb923a5d4da9",
	"0x77d9210d99391a17cd4913117a3f11154148dfb7b3f61311",
	"0xc89bd8f0711fcbd3bac3f88f8b870546e950e71ee5327ed07263744bbfab303d",
	"0xbf496628b497ab5e31a4bba7e446183cfff22fd6ea1711c227de99e4f8fec22616443fa40a1939e3",
	"0x4223cb5ee7d2772c654d8f4f13680fdba7fd60768da0bcbff3c1034ed3fa56316b14508c0fd9f91a8d79cf528c382a7f",
	"0xaa82c440922114c791df08444955604bce835dbcea6f909a9f3760aa9e260ff6546bd6cd92744383b53a54812da96e30133df10b8ccf8a1b",
	"0xdcca68a8a69050f1490d365bb4f57933f8cdd835ffd69b77ed49a661ce5ab9bad7cac468cd1ca411fea11ed8031c4ad85eadf5b54d3edfe83fbbdc86879013f9",
	"0xafd27d3dfb914acf8a808855d107e83b47b3bc6bdafd6a79bdb8587faf393d043b74f207ba6033bcb2c5cfe73088677573778556b8085c8e3e65798fc792d4dd6b6d137a6777b80d",
	"0xee07b1ee32e791b4262c5e934162c176780cc385c226e0a4f4411236e76e9f41698484d2d020f848d6fdd1bab28a934b7fbffc33aa09e37f5b87e809f44217ca35874d989d6ac824330c8d3a57a126cb",
	"0x3d8d570ac6e213cd658d871b135f0187be6009b09082993bf956a831961b6025d5407fa1ec58f292bead6f2a080009e34bfddab5c632c03aa71f1d4b6486f8383552f03bb9d290b28f39608b12288be9ac489ec4b7023027",
	"0x2fd6f015b25daf9cc0aab346cd8816f23f4bb5025bebbcf28855326104393390fab7e714ea8241515b77e976aa08b8b3b639785d7b8ceaa3c01c765561497c771b56c50a439d5b11e358e1e35a7d4664ac9e94848d6e0fbb6b94a5500dc19d13",
	"0x86b166709f1783cd763d8ffbe884139061b3a18a499c42bf1a82c7fa354b869d1d90761d2e179e73d59a500ab46bed6b5ee73e786f3728cc6d9a552d69f4c34ba4282295246c37c11b6b7ca62b1210cf5989d1b66945e1a63c577356283055f161f6209f62357457",
	"0xfb537603516dc8b71b22ee0fd0aaecacef3885f88f981f59ea2701be4bbc0e6203b032f0ae7a5a1caa461c2525e49d111db316403aa565afc5cf1ab4c15e70552734db8f9d2aa0ec798eb7992c5b54e981b5bc4b97fc537e177ee34315f57e396f8806f1b9281eb226758918daebeeb",
	"0xbccd724db945f63efac117fa55fa4e4da8cc3b16b2803c9ca2554c741797b1d8d51b97efe37f95517db29511864ca47134adc04994604cb527b8df2d454b298c0f7cb4254faa28684b623d2900d49fab9c21e07ad7750838b1c667084d5d736fb31d815e0cce3c44472751bc27e5e4ecf542703c097fa249",
	"0x668fe5f05edf78aa005e2d23e57937127f115e85c80aad36a8e052fda2e42272e27d8f2e81949afed1201184edb6d059466598182bee9c1a0789b5de4780ee3279eb9428027a72574f066d107c096f6c1723ecf885a992bf75220b8b1a0c7966dc5902fedf0bf58100bc7b30cc53325899bff8feb69976a06138efef1c12348f",
	"0xf3e659fe97a495cd4bb4e0434595302364b86e2b04cb0f71429f5acfb8fc5ffc5360869403f1f666e1db56d07030fc376cc4d941e47c7d0c3ececb4799a30ae6bb18cf14776adb8ec91cbf35086a1554eeb1cdca395939389f87c8ce5512c974d6ac396030730f79d2fdd74c9317c8ee8939889d8707a6f259a9c78c1c3ff8019cb4ee78edab3a99",
	"0x957820f920c1b4466a1b25b1f61432e2d4a0aaf6d5fb55cc1c7fa38680a82cca8b7045ded7304eb569063d6a0966c57e464136bb0f30d948343fbb3fbb945547454e833e71e36ebdd74cb0824f80af2b6e8a7330d76e031946586dcae20686a60b4c64f65b63f74d5680c19932c68bf1219b97b9c810bab7bbab797c77de5ed3362afeff834c9a94368972811105cc55",
	"0x2593fe7757711977e18e0d822a63593f62164e1d280f43b8013a5ee050fb8a651129d31b3d5ff8bb8751ea4e41f2571bda20c5577c2fdf5578868b60fe6a1e6627dc578fa7d2d05c0d5d7c542fb2f2171a5060d294458668fe3829024a9f678304ac7b82b3e4c8743e4ff9c83a37aba2f569fc893b2eef1b4f40dc7dca96cf787d274852fad2dd8287564973cf42cd7be8fb2c102daa4343",
	"0x955819d3641193a4857e4c42c94f0f79ba04c10a4e61c713a5b3283fae9f75cbe4d6c502bd5b6058caf4021b2d0df65fced2c48e9ec98eda21170fc7bca4830b94f8de40d5b9dfe165d0399f70e3c7d06c08910b42c11294b555fa5befd964afb466aa87e08456adc41a80133f48a8751441a2c62749dd2bb2ac19c7ea1545ab96b41980784817dd3050f898d17af5d7a36716ef0e942ecea0735aeb3a49fc19",
	"0x410f3bf1dc4ac68775a7c4e421b6f7a35cb3b9a09792b07bb7ad4c36f85c65a1db22bae2f5a58de45e1cb91e74cdaf4f077f3ed37235ade0387620b4afb4eacb66bb853b40fe469a1da41ab4d311202a51c9956dba14c351f7d4d2e0e6f277433ec30be07c7fedcc56b66629436fb20c3deec5b986288c03e5902808b664947daa8633fc160f621f5d0700406db35a8ebe485eaf9844139b08861a8ee7b171d83378d09329462bbf",
	"0x239d5dd33cb4affae09f629aed1844cc3b94126bbf7f24b43ec9943bc4fe151f54c4e44304ccc3d16bfe6f455f7e8b46ea53094f65dc4b31f1f045e65ffbc5eda0638002ad45dbaaf5bc615b1baa4647625f5d026832c1189afb047affe9eac137cd63070931c2593d7505adc056c461b842d8f555ffdc8fa38076b23f6a31ce2a83deb9b101f127f34139eb9131c547b00370f0d246274fefe970c2cf6a2265af852a02f42c4cd0ea6b93b956507fb5",
	"0x652944b615cf0ae2c393755c85425d189d29e2b33023cd88bb80800cede84f40e35df3ad9d654c85a00b2928baebb204c126b50dbb76e2c922ceb2bd90258a7b0df806e98b844a1e956b49835dd87544252d7c3f104ca730add15a1fac901d6656a22becb2726804a5020d462ede1fb8e94c85930aebc3c4044d010c3a9557ac8357f461417978c965180f321035f7ca0ba822bd27a5909f95f905fd254026622352093bd58c9ca063dc57e30866d771ed2e0e6b6d4dbc63",
	"0x5a00e8f5741e82661f3fd1ac264f5735064eae93b7e62b356bab3df18bb900f7b253ea5b5cb7c013b7dc8d9f988169c382f73c97ae56882fbcf1c3ff74a2475ff1413184b59ed33e1235efc61313a6fae2950af72416e65c4d513d16988de29bc663752cd1b04411dae2141ef0ba0c8516f5726c14231b8cdf756b0dda5207e608cce5ea54cbc9f7bd09fcd9cb3619f760fa11d1567552ee7fe1e02feef0a3e619b8261c8c5f47d3c773ff5a6a092f1f25883a35eebfdd570f6a18e5522048cd",
	"0xf84488b48341d19196a9ac58878d66414a417bd9213862cff36dc34196ccf9f969b2367f4841658138b81f455a28ab851e560b0a77a702ca28500412f21c2016771613ad6d3a679d0cec426ec8bdc867555adccc84603c47904d117559e6f21a545cd40b93c9494bea4ce668f124f1310fc0269250c9348fdcad0ee741ef9dceb1ee436612cf3df1534f0bc391da565b0235e3f3a13733d8d86648d944fb45fe96ae35189eb298d75b80bbdffdb2742e02efabfe3d5aa466f1b7539b4b90cc6040882ab379c56b9d",
	"0xf2dfaf293d6dc4c5171df063233210356f31a421f4b468087579cbf123a3afd69bb2a17345cc2ea63ee4cb6c9fd94afe7c136cebd355b65892d49a066ca414d7dcd1451e6bb4bea696eb45c9b52d490b5487bd191468fe27dcbbac7660475e55ace3e8a9d6fc4e3f256a82aaf2fc7da08549bb0806b07187b26367d599fc329c0bdadf402694dd5aa3a10bbeba594d563811f923a6d7ac2f698a25eb6f40c9bef544815e923916d4750bb7c770fd9e501a97c1166f1abe2426dc6a9e28ccfb3bbd2bef84c03f758e7cd630aca6a9678f",
	"0xe8d7bb0d1946b63b2f20a0699a30f5c94c2bc31ab2d99c1433d8be8396c6b75321e085f1f3ddf9a6d9150745b009c3b04b977b2c2f86660d43238d411c84e33829e05c1f06cd0aa0da7611f9e796081b21dd0a6a4b3ecc38818b34172c6141695ba64ff1d7c95509ccd1c74bdc26dbe21e21fcf34afa37aaf50f39829ec80ef7c007894ddb1d44b410602b804e2805df28a683f9b98ab384612c7b6c1034ec1148c55601a0a0deee2b9759dfcf22f1f0afafde93499dc9f2c83a7475d6e410c4a38c037530870a49b74941574fb2af9eef96abce70c78e0d",
	"0x931502aca02074c073082f96564809bd0618cb1f641ec3d85059062b58738d88c7b897c2e893f8518afff5992cca88b163308c3f53d1aae9dde4ebeead1a7ba10378bc258a02868f0d5f94c749bbbd3786c4c93eecd56d3138d80df330e5513e38668334744bc5837cd7de31485a708dec2cdea2c38c14e2b447a53c218771d066dda1aa42e17cbd5c03b92755a5e5c1edd417d8d5f33366a08c89f2e9eab80c52c15de5b93259828be8f5354457d7fa9f8839b5917bb9f67c724f53aee551d80a1453bbcfe32a9a90b1f572bfd71161dfe7f9ad21fb4522ea7a3f824644ee95",
	"0x9d947f48e78c68cc7fe4df275810b4ca4d3c13dd668bb31420946f65e8ea4700e07781ff4ab4eb57db137dabcfa7b0f674bd01f2838f1d7fe923b93598babb3376f26a854bade6f4a18ab275496b6f7069217c3fa6853b42f04d03f166c3b9d1e6841ca04ea680302d373ddc495c1ccd11c075159556b5c60813da6a0d74850d7f006c1664e926aff924031b06102ff3d1146f720def4dd312a604f4eb7ce57c45e600256e8d5e6e2f400a86a6fb024469acc7bb7125c9a22a9df6ca59e07cdc59af748b0e8cb01dea9817b28f4a31cafdef4990c92600fece3c7412c8bf2e997fec051dfdd095cb",
	"0x8f67b04bf4d8249cf62c24d59f949965bc04d51194e33eff18a84f96e039f5bd2b511ceb6cf7cae3c4b3c5870a33fdd115cde52e9a748824fed1403321a4378e26098bf19bdce49391ad9f9ab80a2ef2b71f51aa8730cb34cc2a0889692f796a0876026f65546765c60f4fcb8caba6699c766cc37308140b22b9c6f8def8ed95c1270ac1e762b89ad4ee7989954fe50d15485dbdfb8c9b4271a67f0eb8fb0355c5a8c936c1c5307ab00bcc25c12d8ff9ccf916360a7abfe0acc7e7952e67ada16d3f87e28d7d80129b111908465d66b0ee0f2526bc1ac76ad350d910e8ee3114ad8f6b5da500f837ff04aab4620d132f",
	"0xecd63be2e58c47f4b3cedbfcd7f6c44e544c6d12a2c6acd3a1d4470e18d39da6b2520dd543e52c3aa3d4003daaf4897afbaf4b0575b22ab71d1fd3eeda850c0553e3dbd55ced8c8f8590ec3241ad565ed839768c9ad50622a077c4d74b206cff598c8e1c021f4d066179c05861109ee14678ebeb0412ad3a8ec4a62de102fbdccd19c4a766df652a77c9d505f90971162f512acf21723c6dcc9b587606322d0a9209c6a6c797f49b4abbc072d9bffc9b85912d8570e162fe9239c7f293b8de11deb120b871be0820925d694f38646d99158696cb23872870c216c4dbabc9eba557545fe4bf090ce26ac3fe4c3c7abe2a27de3d918a4b3db9",
	"0xfe69f44ed99470cecb87f60c65e59f7975dd6f6d218c6205fd3dff7805fcd7ae9908f1fa7842556f77592d895b7bf3dcd2dd6d63637db19b65be1dd339fda631d49fad1239e609b73a8be425ccbccb87afc39ff062fbe69d93f9bc73a82bd437405fb340cc2185312810bbb1ea9ecf0559d5159c598d37633a355f7025a76e9d90b72ab8fa2469eedc09e054bbb611c9c3bcbfe0bb8f220a3ffd7f5a1172cd2c28000089e45a7d36e22f56a61ba00b6ace15e50ac3bf0d7ac1c6fc02dcc0d01ba18cb3d2f77113d1aa0fe2aa7ab9af6873911a145f16dc9724fe0e644ec5623295a65dddd6c5dd118b297f092b3cda4889ee1b5f52d19514f774bc3befd68f4b",
	"0xbe033362228c50d6e9a8474e95988295a5060c74836adca9dd3d23c966b3889ef566d214b3a729be483df348f01a27cbd6ebf77866ecd6e1cacd546520873213",
	"0x93831a60c3c5d6ace5ba068dde4e9ea797e7be20f1341bc7ac899d69a061fa06bf18eba1cd4a3b14145d68d77c0cbaa33ad434e666ea323fb3952f422cfd1a5",
	"0x89de96c50f5652d5388a904a127dcf975606185164b59df1b36f3c7cf9e5bccf89e96f92701d3a80e4c3efe6b1c71686f4aab6e8c2ea91cbe1843f951e0f124b",
	"0xaeee57d2552b9721db15f68b76d89539a9a2d90aa0fcd5187538431a0e4ce4e0f67384e4298465f5f625b08d5777534ae67bfb2ffa6ad2bdd9f858f77c9e77b9",
	"0x83309d8b12d74fd2e6ca15b680f85bdeec223d6968872d0b77dd75fccb2ddcb2d507bfbf95ccb8737ca29acaff43d315221df5d51fd2e355c35efaa55c715a9",
	"0x3435118d71583652d55e3d932afdec06467d6462918fa13e79fbfc709a101ed8f75476a699f2b9091e2b812c80a63d6ffc4424785833e83c5c8173aaba91682d",
	"0x833f1c66fafc8113be98087bd23f3cba017d3022ed4a0ae86396b5a6aa7a77ba883bf73ecc2898b9a923f49ad270982bb65243410e7e43a8e272d8631f35004d",
	"0xeae95e226bc4520a79f69eebd4476e4f10d67f131706903239a4d45608631e92853c29485679bb620a651f1b0093dfac122bae531b11aefcbe7a218cf39d6049",
	"0xe1df218813a39eaeefd08eb9886cb3ec3a52cf2b7f9f1dc35cef18b46b507f0ad318f8c233b07694de2f023812106ed93d9b7cae6b6677f890738d05d3a638eb",
	"0xe43d9d5bef6850f3131fb1b950493e41653acc708a27143b7cd727f3d7d291b4abf6f2e34a80d0f74403e8f86f824a4eac87db6992ef18d50a9fc1b466a717bb",
	"0x529052cc055d7726e3beae264d93d7b1243a38936a86e8167c7e6969b7dd8ceb0115ca69beb19e9cef09aff2824c0928bfcd1a016ddb615be9e68630fba8a464792f3bab64feb0356b6d2c3be2f71efc765a161e3c3d0a87dc2b9f59d508d445c5a6f5d19fb04a0da87555eb23c0534ae84b53ccb98d91bd536656429dba0ae9",
	"0xf63c49e60838ee36621ef249efcc6852ad36753982aa7a2d54a860c8fdc2f5951506c05631158945c1ec2226665b04342ba301dee6a976593309cd9a7b55122d2b86b68dffa901f873987f2587bce3fe9595a25814e80e040bc5ab301153475484f180fd9ec4c0aeab4e5f508c050bc310bf2468bb27f4b15e311b87e12b4689",
	"0xf6b548c66edf8c59d2e6a3851706c985853bfd6da7da7fdf33bfe7b3156fa1ae52fff5ee0c3386b6337463cc72124d4dba4d0aed6f9008f324a8df845508e9d2f7c386132de5d5a11c215e57a05df7a33b536df2ffc473ae2e5d4c50d48634b1a4690130e88e3c58ca80b20dfecd468621ff7b5f8d1656dd1e3fa7263e9b50b5",
	"0x8ecddf1adafc6dd48e5379015eebf7484e56dec7ab4e5e69e6d5bb54002c577628dc4a89fd353056d98a417f021368fd284829c75a5cf48d721b3ac97da65ac4af00c15a258ec4408ddec19e055a10f563ad6b9f10d2fbbab94f33c9d001546b636ccb38126e14da609a61b43a0ba20c97f387837d7e06bc1ca6740bd9436e03",
	"0x18cf73f2519889832a0eb5d3af924be6c946d8236ee59c38e1c770d0db9763e37707a8c92f5c4b712cdd40dc2f6dd306bb08a3c67e566fdc3118ce410f1200479feec4fe4eafd6ec5ea2f0e0f43b0026e10cc54d3e477bc4e99c30c91d97c9056c855e490b028cdf937feb729ced6d262d605cc12465b479a2c17c74773a6a5",
	"0x7c6732c26cb73c8e18ea32aa29cf8d0278a77af69630924bb21e79eb059b79d1d5a15be59bd7b65b0f26615b902b1161844b06b1070901fc38a6f34c1669ba388497c2a7957fbc9a9529431289c98cc09a1b80595cb1b2e213bd775c3eb9b1bcb3c6c5a0922faee09d5a7988c75fcc2ce17254cdca4a7b73a4b599ed9ad069d5",
	"0xc2f1a6f9e04c97147a2fd3cc482e933009819e138b33e2a965bb3ab7c6b7e7c8b62b9bb9a1867ce493e220eeb380e4266e2afc58c7a2b6da81b1640e674281ee858945d520299d226c943c9899b7d3242646adaab1533effec5ff9c38f8a0e92569bdf237cc37c25cd6d1e5efe8b06d9fd01eb74dcff9e1cc771a8cfa9a8fe17",
	"0xe7f7b3ce6b93a9ce4aaedf070662973d3e80c1814e8f752c63174eac50ad7b50dda66c194bf5e7749c3b5e7a9d5b844f51e718002644961b91f99ca1e7f3d3f149eb5994193b11bbc91c486fd3f9b7cfc2c4803c414711e7a2d525d969884f5642eac65bd5ab0901543f803e3d2a7aeb7df7b1e50cec3a9374bc439ba0a60d7",
	"0x1be10612ff5142ef727cabb5258fecf19672da365eaed323c97a9c6822ca934a560e940c29a6a612cdb096ea9d62de34ba12f0201e0f3572a18c5f42a73b6b9cb96801f0581cadc34de00ac3ddc3863a74202c6c4cbcb08c69b919d5f4751e0a86cda7b6ef6580ce5ee52a0e865e7c7064e128f687648cf46b16041d27b56001",
	"0x8dc966d88d264614fedfbf092fe0303186b4ab6ee1f2727bbc851d4e6ffccf3b7969ee9335a531ab90de9f170e7dc3aa2feeaa9de7439bb28bf14190f8e013c7475bf4094103da78393a7f1b68c8297466ddfbab8e5154a64d7fc05001d3991398d1999a4dc94ddcd072c11366b4ec54023fac10b45ca5feaa3a900c3c78f15b",
	"0x6bd20f33ffc72befc24e75557edebfd9ae137afc90c6c368e0d6056c8691602cf3eeb7bf52b725fcd97da4287c13d359f12f76d3aa26ca98015f89ae39dedf67d29d4f547e3ef67d3b6f91fe26473efc8fba8f5bdbd583c0edbaf8f192f1a021940dbc9eaf93e49d65b6bfe400d01c5e52b8acf200c3aba310817e0aec29f33421227fa8ffecd7efa89216573ebf0b0da831792bd2c4ac2a8d29a28922125d24f4ce47981338b2100d6f02fcb36515e7afa4e0b02d3521ac62ec9f82e67612c9",
	"0x9116dcf0edc8f8922e67ad4b3f38989d126a9673a757f5b2bdff9fcbc533bbad1e0e008340f2442625ecb2c0b914a177ab6f2598c06d0a63702f40ac1b026c64d9ee224da7acc2deff3254c89c6022634392bee0e99694acf98f8633c8869b534174fdbe9b3c1ca3bc5a653e0a301b8289f55c82569de21478bd16687aa2424859c476449303426a488f57ad4554790e824043ff4bbd8cc0834e086ecaaa157a57ecd3686cc3c2ed05775e11202c9ddcdebacb1520c99bdb325507bf7f071ff9",
	"0xd6e9f77717bcf8cf1e040a97df6f98f389a0cbb6613312fa435ce14fbb683ea388f9b3d759b20bdfb12517d05c0f93dad4cab7e496b7683b1b0bf74b5ce4e0cdee2a4866e6c035e34a8e062defb1a04bd8fb12499ef0e37e862f340ff05452ccc76b214946be406cc7c38bf35f4fd0fc4272bd650e29feb54d18bc5402d6af0d96468264b38c8177523b7b263d521d5bc91b10ae782ed2d9d971a26d9cc4d7ca74421d53aa498a9f470bedf511b7055a6085ba357c4983e7bd45e092ea920781",
	"0xf7a05169d5604a7a6e5027d16c526668d5b69424b57e42c5d12595ed0ba939bcd5bf1502d83fa21f65b09fcff5743e7f1b7524ff4f6d3663aaf8cabd1423df463e050c7a3e332c2e3191dbfa107e6ba3a46e4a53636c1b38e46b2912635711365d5a819cb5a72bc496512f91148662e0106073223a2f64b692c54217436a246145fbf22974323c8f7a4ea53a8b513089c512c92510f8a1dba7690357d0cfbd3a8abd7ef96b6874c3ce08e527353b6c19a80f12b833ddf49e61c41fdfff90f6f7",
	"0xb03ee6223e6a7db6bf3b82cca6b3e3e857223e8a8e283d08f17cea744fef359992ec44ea02064c215c541ce6841ec6a3c1bf7d163e658b155f0cf98181852d89e30e7a5d9a02453fa0beb23c115b47043cef8cdf204219ddc6877db53029e1651fc8e380589844cd9544fba8121b1f51ee6b626611afa0e960a9aa7912770a30418c13302a4f5f63ca54f68d57e698961d4477aac653a7ff0e07ec8d1410acb3aae45a7b1719e454bfa148731869a0856aacc762c3a45b037b3192007c3b6de1",
	"0x9f0d63d7751ef78781f921f47be79464565412a82d81bf5f32e3d4fb14103225765a12943e72733d5f70a7668dce9e5d5348cdb51fd5e54ff549ac44285b6f4ba1111738b041ee68d627d9e01ec5a9194adc5b4cc2ad16b5468d8d8739decf0c63e8acce0fbaf5e2c936ce5a03e18810fdce842fed6b7347b7927da001c5199c7e77673d2a914d80fbc11c4ce9d03b8673c7432893f32b7a3aca0ee4a9747a2063b313a3321923d9bb1dbecbe28b623b9e9e5063a33dfa637a00623a88efd103",
	"0x227bb5abda4ec121030a7e211ea23dc1df7e4eba01d71d3ef6742dae6f7b210ff3c1a1cde26d2085a4107d6ea73dec1b498ae781d39883dcf6272a9c39f35883650f398adf370be97bdc92011cec9b7bcc8b6cb2509ef8598992a394af850807828129050a61f05257558ea90d6502b0861e3716823de674e476abdcc37818a02af0ead78d23ffb65a7f5aea74f2f03f3fa26936d600abeb1085bac2a95225c2308abb584cf5ad9f3c72afb477d65c74753fdb3de10ce8441548c4a5cc807721",
	"0x8a08223b65528502f9f2b06be0f39211d25b6861dd53616b9c1548286eef76837ec32834cfed508b3fd6626dda8221295c606446a8103a0c5d8763355faccfec1c67a73cd7dfc2af2327c8a094c1cd4a929bd0767c639dfcbedb6b0bf6b372574953db0a126bedeb27a824c00b4aff4f5b0bd4a20fe4a28514ed0e8e7624e7e9cddc03aa9f373ced77e4a1ce6b974af0d6d9c4be24f77ae5d83451c772a7ebc89c32963ca012713134651b9249a8537f7b335738b71ab35e1829a00c95953067",
	"0x24e7175c205b85cb38b4373061ee83e5c71f804125e71c306a77f4945dff15a9d17a0980d415b771aded1b204d6b380a97b95a0750c7629e9afc0110b9209add1e2b5798b02bf7a4c4e48d63ff2060a19ca045079e0229954a952e3de47fb304695f06a119f8ea83d171dd8acfd9e8a3c405ddefbe42ecbe63a978b6013150d6790ef7d881f727d8dba7b9dbcc075dc4f7ed8f86b7f89292174503811a3192d34f1ebabfa4c38081033e03d6f11a5dd3262054b45f07f8bd122fc9e963e4ee35",
	"0x56d09da3a8438870952fa784ccae937727b3cad113c4b3bbe3ab59ff264beaf3f75d0541c1b9aefd1e7b20dd451d3e811981531f3b5efe412df7390a5556ef73735fe3b3b3a69f4eb00415fa4d6c11b6a8d6c6a7c0dc9977c2a7f7f2239be2019e352257a4f9ea93dc26d23bd2cff472781b5f9806040bb69bb74b870d31e53ce3f982da92fc63f6ddeec8ca10035272a5ff66adb2da090f9e4af29b8461984c4916907590c0ad628086fba3720a404167b8dd3bd480bfaa3ad54a0b4a418b4f",
	"0xfbf839ce7821fbd92f2b984198eb564f885a50a75b9398e5f73466f8712d321492ef482f013d9c8d132c6e31a8625bb4cfee3a513ed42be6ba95acc68c8969a8ffcdd50737f047dd69f90308f017b5bb3065712635b2652e64ba8fb63543cd03bb533629d42c1c87a0e50c2ef0c6f4a4d6a243c6c15d3f29ff82f9bb96e4df595168d84e52c1829f5033a4e55a5c8aba88bd4dfddcd3ca207d567cc451989d0914cfcc1aa9c56cc974980b16b8665de7b778a046ad03d8f2d4f2cca6bbcffedb480bbdfc353b72870c72a19debfe8be33f51297fcb17626e962f4fcab13a4e07ba62a7f8688195ceaf280b49c645f88a2a94633e850bc604940f877b80b9b925",
	"0xd275998fdf5a944d4a5f3ebf2c42901ed9a5559956d5ad0d5cf9b2fbdc4ad0a233c409d2840e1a325c0b0d1a7a086cca0a61efcfd9e48b5372d8f69336da9e26a4be375c80d5db65329a692a0684fda696efd9eb889b6c587a4ba57c6cdeae021cc30146c4c6630a881e2f675204bcb7072db2cd28216d43394ff1bd741a5be57c2b81a083849d9d657fc80a29e4ff4082083bc9e9321cdfa9cfe9d19675b15f7362cfd9f62ef431be56ead378e29186f5a7531eb84c79e966fb4e86d15652486556556955f4bde80d0a63c5d347f0524ff802d8ebf1f746618a05aa7f2a3f8595e09adcf4294e8f8af21de86d9129f022e6cc303dec22bed0c48ccd6be00529",
	"0x3b1e441f1a447f0cc5c4310c1b5940842e5cd692a1a325356f3b475724301336b70841c73bfc752e7ab563c06dde60d1c3397316792d7072c009726a34ef4b1224ee800697ffc1c7eb72d1fd8d2323fa9a52fd59b905bfc16b39af921b528f525323503e7db92ab611d9694bdcf46cfe76cacc9d56ba77eb62c804d5a597a93001ab1f27ac4ba7e7be091c8a39dadced84cabe63f871840e64433fe6bcec5e95470f20b7b0c3fc729edc08ce0ac365b32c047ff8ae103e69f335861841cea4923ab70a01d30a29f05a6c1970aa6def0010f36c7ceaffe72ce5cedf9174122212cf9daacb4c30b282c7f59434824a80678e0724b9f110d13120432f62ab33e807",
	"0xc8190826433c38261637899388d74c75cebc09de88288221bbaed255a51dfcf66755147c812fac4fe7f2a17cf140f0ff21e8aa63dc98d163d1700cf3da46767404926648b64b752394f61f4d990da28e97ca9c641d8db8be9e29f169edc1f739d39fa31c930002d78a43a808de88f351b18e43e31501e97986c8417f62ac48739151cd92925ebb24a4b168af06625e5461f427c7ed76732da1bb95481e316dd34abeaa2386efb35d0b46b2c3fb73e997dfbf1905b42133caf6aa94e9768e27777088523764e1ce94cd29d4447c1297863209dd3452ddc0702e0d77565dbe3b12ade3ffe84ffc759e22495637b95d9fa7eeb46f2924a7a1218ecb554789e81c75",
	"0xc571d6c9f066a8f89a121210e312d5bbe36c92f0f60ec6e67a7c764b5571ca51abd892f54561fe0f89878673b03e39895645f48990f42035aa934dd28e24bb1b7e83d96bb83d7bbf570717413233633bb6c0049952bae51e002a2759e2b9fea60298ebde22f21c4252f784942e5349435d2a7e9fe3fe8849fcfc35d5a23e1cd0926cedb38ff6975bf2e3d23d082f89122fb1ed06e7f404c85512bbe39f609e1e6c9ad5deb1e7db2ecdda5f986c3a600719b68f0afc73bff32a82af171c75712e3e20bf8401f03afc0783e0055df0d62f5752bf2c1bf68e418b3f84de568e1c9673e6a8e17eaf33be83679b2e07e9cf4cf3d602fe354f2e71b4d5b046369efee1",
	"0x16ff82ffc53f28acfdcdf3cf3ba0b5c656af341943bda8e842d647132149f28944cfb30aa4186c521ce481aa906550188bc14ce4fe8a34daf16e24c39ee5b52020485d8442e93b32ce99db860e776ab91a6eb58961f54fa7351a590f23c7fff12996b9a75ec4f0e823726ffbabb0dbf15c97320aa59b17acbd00cd229f8125b16404414da01c405e9a477cc3488edfa5c31fe01a9b10ea46e8af6e2d11c08fbe02b8085968baaed85f42dbe6755bd9d72c70e302e1a6e10f17e37405d550dd0b73e8ebfda2d4f4393641d3e5ba712495c3eadfebfc5c5fd0f22875f69862bc4362a0bf6f49b926d54521b3645b6d7e8df0f2824345a0910fce1d3c51241402ef",
	"0x6c26ef29c1e6b06225ec8abde1a1fa28d85640de6675d5070fac78eda77e3b00855de0dae9de0d28363d2f509079f0a7df5112e1eabf7e453a66d5d9e3bb5943e3adf702d9171f82ff72501f91dd77bb78dea596c88f557d480d7b99d87485eba3c28ab1da718561fa36d8ce48271b77af4f35cbb9624cdf9438519f1dd8e783b5dfaa645599ed2bb944b4d152a58561842761d0c8cf2ee1ecd28e24ce62aa8c27f8087f78b50af6d24d16ec9ef7225f9c0cadea36b3fc3569ff35eac4092f9064b2661fd7ea07a898da944b52d6820082e3bdbe40fdf0bced036f3dfe6a5f6356789b63df5abace852aa08dd63a2194ca9d9408192da09a3a5add9b0f73f6e1",
	"0xcf574889e335d3c369a5f0adae4951bb36d50b0a0f2d0370fc483df730b3260b0312c4b679ca50f80f7fc6d86d0297401304f13a9127c88a2afe6598e26131eb5f0ce5a544668b183cf1da21a858bd61f8c8bf50becc3d5afca49e6bc226ea163d408b8d4d5bf33e28560e413d822b2b420efe01e2bc66bf207a4db5e0a6c423c99fde851e47e8e5b246fb95f13095afb45d95dedc3fbfbb370fedab80017bb9cc3292e43e29ab384fd5522736ff706a373783cbf9f7f5af9e7a71e2127096ff5438f942caa2df39f1f2578b7c7beddd02c806875add8603dd1869fe8fa1f21294a4d543c615062e6ca3347225e0b32aeef4b92d34c00879edcc878811736255",
	"0xf2dee9b305610ad21684bfd13374cd5a1b106bbbddab4a5929b48506e0d6995a3319cef5991115dea032786cce89b2940c52c84c86d8d1fa0e773b1fa0d9987590faca536c7cb085a75174b6ad86ce76afe4996692748b43b30a75dfb965abad2238e99bf53b8198f9520d0dbeb95f3ec128d1105b7f826224502a9ce813c6541993788288f88d043f1a01d9767500d12476515fd32a0bb69f8e64c2e1a48693ecba2de00189f0af4af73772ad0035d257178198e1dbabab45c2f92903e985dc4af39afec68c511a909d48c10c9e30c2e5dd572978535be179d3d13be5b9426e7b0b3043ce932a3d763fc03fa60fa8d0d9f50be3712e1acc647e5af034a5c68d",
	"0xba02224983ed209c818fe19fabbb354dc8b6a84a02504182caf2badf410d85a90e741d07fdcbbc70c27c4be66ba2f7033d5c2c0c722ff97bf85fadb7f2f29e39520e49b15a3a4d06831a19fe21162dba659f045a6ad9e5a7b1a59298e792554508fbebf35c0a4fa79eb2127a03ab54a9c0be4ffdab4e9ac47eab6b87e83beca70ccdde8ba685bae14d55ef68a241ae76b59a039854633e8a47aa33ead7992a8c75dc98d0c743c168168711d3619da859084e28ad22cb5ea651fae3d8ec70a75f9e7c9dbb265e294a311a9d9dee93332a0879f9689753599701cba26e1105f15e81cd669d59a184fc6906be7e3d471652cfa035b6abae40dee1b1c9bbb4c42127",
}

func testMontgomeryReduction(t *testing.T, f montRed, r *rand.Rand) {
	one := NewInt(1)
	_B := new(Int).Lsh(one, _W)

	for i, p := range setOfPrimes {
		for j := 0; j < 100; j++ {
			m := natFromString(p)
			n := len(m)

			// Generating a random input
			x := nat(nil).random(r, m, n)

			// Generating want
			T := &Int{abs: x}
			mi := &Int{abs: m}
			out := new(Int).Mod(new(Int).Mul(T, new(Int).ModInverse(new(Int).Lsh(one, uint(len(m))*_W), mi)), mi)
			want := out.abs.norm()

			// Generating k0
			k := new(Int).Mod(&Int{abs: m}, _B)
			k = new(Int).Sub(_B, k)
			k = new(Int).Mod(k, _B)
			k0 := Word(new(Int).ModInverse(k, _B).Uint64())

			// Generating got
			got := nat(nil).make(2 * n)
			copy(got, x)
			c := f(got, m, k0)
			got = got[n : 2*n]

			// got can be larger than 2**(n*_W)
			if c != 0 {
				subVV(got, got, m)
			}
			// got can be larger than modulus m
			if got.cmp(m) >= 0 {
				subVV(got, got, m)
			}
			got = got.norm()

			if got.cmp(want) != 0 {
				t.Errorf("#(%d,%d) got %s want %s", i, j, got.utoa(16), want.utoa(16))
			}
		}
	}
}

func TestMontgomeryReduction(t *testing.T) {
	r := rand.New(rand.NewSource(int64(time.Now().UnixNano())))
	testMontgomeryReduction(t, montReduction_mulq, r)
	if cpu.X86.HasBMI2 {
		testMontgomeryReduction(t, montReduction_mulx, r)
	}
	if cpu.X86.HasBMI2 && cpu.X86.HasADX {
		testMontgomeryReduction(t, montReduction_mulx_adx, r)
	}
}

var devel_expTests = []struct {
	x, y, m string
	out     string
}{
	// y <= 0
	{"0", "0", "", "1"},
	{"1", "0", "", "1"},
	{"-10", "0", "", "1"},
	{"1234", "-1", "", "1"},

	// m == 1
	{"0", "0", "1", "0"},
	{"1", "0", "1", "0"},
	{"-10", "0", "1", "0"},
	{"1234", "-1", "1", "0"},

	// misc
	{"5", "1", "3", "2"},
	{"5", "-7", "", "1"},
	{"-5", "-7", "", "1"},
	{"5", "0", "", "1"},
	{"-5", "0", "", "1"},
	{"5", "1", "", "5"},
	{"-5", "1", "", "-5"},
	{"-5", "1", "7", "2"},
	{"-2", "3", "2", "0"},
	{"5", "2", "", "25"},
	{"1", "65537", "2", "1"},
	{"0x8000000000000000", "2", "", "0x40000000000000000000000000000000"},
	{"0x8000000000000000", "2", "6719", "4944"},
	{"0x8000000000000000", "3", "6719", "5447"},
	{"0x8000000000000000", "1000", "6719", "1603"},
	{"0x8000000000000000", "1000000", "6719", "3199"},
	{"0x8000000000000000", "-1000000", "6719", "1"},

	{"0xffffffffffffffffffffffffffffffff", "0x12345678123456781234567812345678123456789", "0x01112222333344445555666677778889", "0x36168FA1DB3AAE6C8CE647E137F97A"},

	{
		"2938462938472983472983659726349017249287491026512746239764525612965293865296239471239874193284792387498274256129746192347",
		"298472983472983471903246121093472394872319615612417471234712061",
		"29834729834729834729347290846729561262544958723956495615629569234729836259263598127342374289365912465901365498236492183464",
		"23537740700184054162508175125554701713153216681790245129157191391322321508055833908509185839069455749219131480588829346291",
	},
	// test case for issue 8822
	{
		"11001289118363089646017359372117963499250546375269047542777928006103246876688756735760905680604646624353196869572752623285140408755420374049317646428185270079555372763503115646054602867593662923894140940837479507194934267532831694565516466765025434902348314525627418515646588160955862839022051353653052947073136084780742729727874803457643848197499548297570026926927502505634297079527299004267769780768565695459945235586892627059178884998772989397505061206395455591503771677500931269477503508150175717121828518985901959919560700853226255420793148986854391552859459511723547532575574664944815966793196961286234040892865",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73",
		"21484252197776302499639938883777710321993113097987201050501182909581359357618579566746556372589385361683610524730509041328855066514963385522570894839035884713051640171474186548713546686476761306436434146475140156284389181808675016576845833340494848283681088886584219750554408060556769486628029028720727393293111678826356480455433909233520504112074401376133077150471237549474149190242010469539006449596611576612573955754349042329130631128234637924786466585703488460540228477440853493392086251021228087076124706778899179648655221663765993962724699135217212118535057766739392069738618682722216712319320435674779146070442",
	},
	{
		"-0x1BCE04427D8032319A89E5C4136456671AC620883F2C4139E57F91307C485AD2D6204F4F87A58262652DB5DBBAC72B0613E51B835E7153BEC6068F5C8D696B74DBD18FEC316AEF73985CF0475663208EB46B4F17DD9DA55367B03323E5491A70997B90C059FB34809E6EE55BCFBD5F2F52233BFE62E6AA9E4E26A1D4C2439883D14F2633D55D8AA66A1ACD5595E778AC3A280517F1157989E70C1A437B849F1877B779CC3CDDEDE2DAA6594A6C66D181A00A5F777EE60596D8773998F6E988DEAE4CCA60E4DDCF9590543C89F74F603259FCAD71660D30294FBBE6490300F78A9D63FA660DC9417B8B9DDA28BEB3977B621B988E23D4D954F322C3540541BC649ABD504C50FADFD9F0987D58A2BF689313A285E773FF02899A6EF887D1D4A0D2",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73",
		"21484252197776302499639938883777710321993113097987201050501182909581359357618579566746556372589385361683610524730509041328855066514963385522570894839035884713051640171474186548713546686476761306436434146475140156284389181808675016576845833340494848283681088886584219750554408060556769486628029028720727393293111678826356480455433909233520504112074401376133077150471237549474149190242010469539006449596611576612573955754349042329130631128234637924786466585703488460540228477440853493392086251021228087076124706778899179648655221663765993962724699135217212118535057766739392069738618682722216712319320435674779146070442",
	},

	// test cases for issue 13907
	{"0xffffffff00000001", "0xffffffff00000001", "0xffffffff00000001", "0"},
	{"0xffffffffffffffff00000001", "0xffffffffffffffff00000001", "0xffffffffffffffff00000001", "0"},
	{"0xffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffff00000001", "0"},
	{"0xffffffffffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffffffffffff00000001", "0xffffffffffffffffffffffffffffffff00000001", "0"},

	{
		"2",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73", // odd
		"0x6AADD3E3E424D5B713FCAA8D8945B1E055166132038C57BBD2D51C833F0C5EA2007A2324CE514F8E8C2F008A2F36F44005A4039CB55830986F734C93DAF0EB4BAB54A6A8C7081864F44346E9BC6F0A3EB9F2C0146A00C6A05187D0C101E1F2D038CDB70CB5E9E05A2D188AB6CBB46286624D4415E7D4DBFAD3BCC6009D915C406EED38F468B940F41E6BEDC0430DD78E6F19A7DA3A27498A4181E24D738B0072D8F6ADB8C9809A5B033A09785814FD9919F6EF9F83EEA519BEC593855C4C10CBEEC582D4AE0792158823B0275E6AEC35242740468FAF3D5C60FD1E376362B6322F78B7ED0CA1C5BBCD2B49734A56C0967A1D01A100932C837B91D592CE08ABFF",
	},
	{
		"2",
		"0xB08FFB20760FFED58FADA86DFEF71AD72AA0FA763219618FE022C197E54708BB1191C66470250FCE8879487507CEE41381CA4D932F81C2B3F1AB20B539D50DCD",
		"0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF72", // even
		"0x7858794B5897C29F4ED0B40913416AB6C48588484E6A45F2ED3E26C941D878E923575AAC434EE2750E6439A6976F9BB4D64CEDB2A53CE8D04DD48CADCDF8E46F22747C6B81C6CEA86C0D873FBF7CEF262BAAC43A522BD7F32F3CDAC52B9337C77B3DCFB3DB3EDD80476331E82F4B1DF8EFDC1220C92656DFC9197BDC1877804E28D928A2A284B8DED506CBA304435C9D0133C246C98A7D890D1DE60CBC53A024361DA83A9B8775019083D22AC6820ED7C3C68F8E801DD4EC779EE0A05C6EB682EF9840D285B838369BA7E148FA27691D524FAEAF7C6ECE2A4B99A294B9F2C241857B5B90CC8BFFCFCF18DFA7D676131D5CD3855A5A3E8EBFA0CDFADB4D198B4A",
	},
	{ // 512-bit exponentiation odd-modulus
		"0x7eff18a9ca2d7e30de92f3ad18f62b86f34b3bac9d31b59d15b7decb5f0f20b8a9812fb4e717dbfad8cbbe958a7ff3f52c6f77daa8a8f3b75edccc46410cd9c3",
		"0x24e1480a92a7a6f539fe22fd1ee7239febc2bcbd0f75244e68b1a98f49b58db3ddba8fb2a715d90d73946f07a5fc07b3d9e1b2e72b1c916388711b85d8bcf828",
		"0x618501870bb5d2820e9f2125fb74421667484fa20a1521b3f354f5b784270de8198d2941dd2a63ccefba85c4ab9a720ee51581cff567c0c413f44528f56f3b73",
		"0x22e618b966f89a90fd8584f19c2039098395d26061a2c75c44f64a7e2f3e219122f509ac137262aa9264177f74249fd973774d945e53f48fc7bc627d44c99559",
	},
	{ // 1024-bit exponentiation odd-modulus
		"0x1d7aa318d993dbde8d7d3c2718bde532caca727b3e2b889dbc024200a6ed0f68dd693de107d28cd8f345f04d15a42ba3c18b8fe7bd7b82edb814da79c8514eeda640d2ca52def2b3fa1bbce6dd6e8f3e0a391cb153fc0395925ced7fb75793351d1dc9b7aab10c161372dd671cead4c4ec6a73f1aa12f68cb2192d28cff31a35",
		"0x7498082950911d7529c7cb6f0bee4c189935aa3c6707d58c66634cca5954627375b685eee2ae206c02b1949dd616a95d6dd2295e3dc153eb424c1c5978602a0c7e38d74664a260fd82d564c1c326d692b784184dbbc01af48ed19f88f147efea34cbd481d5daf8706c56c741ddfc37791a7b9eb9495b923b4cd7b3a588fe5950",
		"0x49f5c8ab2cd9f069d04b96d73cbdf6f22fac3ec359bf60dbf8feb51eda5d511fd633a1133e59ad20a958d9449bb37015dc24eca6e4d84cf261578025ca3d436daf41652207c885ddb4f7c7542f78fdec35b6f1bf416184f9570a5c584cec443a0ee1a082f9cc5009bd101d7adf299cded7198fe5ad994e49833086b6310c6e71",
		"0x3ceb6fd2c5db73761fc724472a629fea9d2d9427e6c8292c8fb96abba1146e96700cce812b5fcbf64e61fd84251d8a977408cd0ab52bccd0443d830908e674ac8af8da8c6ab62f4b7f9c0e35c6ce8cd3124f2c2ede576e53c218b4d473389a003e10b8d6e7ffe2c791c9e282ee3860580edebc82bdd9d96dbd021678e62b2ef",
	},
	{ // 1536-bit exponentiation odd-modulus
		"0x3c6660449b9b18efdb4074f79b5dc9f4857cf51c11d368fef869c38c1da1d3ddca0aa22fd4cc23b0cad38afefff971de8122160c1f63991f178815e23172fd03dd21382646b9e88fa2814cc54c9aba2bae65b4d0f37ada2d32c068ebd8004d8e063280f40fda85a4f0f85e9feb0ee5e9bfd74a02781784e7c0c047f35d45a6c43de101d691b7d38af938470fe9e4eeb612785e98c10545e3e4f0a8617425d8f946c2660fd539ac1790a150452f26ff757385822a7d666f618d7e074cf546fcec",
		"0x1928f980bfc3f44c7cc3c9bd511e8a97c2a320178c7bc0c288355bcbfe665bae575e99fd5fecc5ab6b0865a62e9893e3c087102072ad083e897909c8526e0e133bd21612c83d45b9c6bafac883e6e0ab05ed031b0673191b65c66140760686f120a147dd0ccf58e04ff2b467149a0d7e03e067dbee7c82d70743565cfe484db9dfa26a2f451a4545ba037a559ae5581777c9d7fed5307f9fa52d39629aa2737a4d19ad8fb7e56114fc7cac89e2b154905863f3afb41de2460661368cf25e4458",
		"0xfbc01e5d3ed3a514218330b5b036d76f7ed4dc15cc86475e0c2414c644d6a689fc7f5e6269d4047e7d0ffe4ecf40fc70e94481aa257877ec9d891ac90097d0174b9a232f78b813966b5070e92d8cc2d0228deea1803a3580d087647c9f9ac09fd1ed39f09b77d9ca18ba6105b12acc6e174c3eeba9f77d8a9c98756d051ce1ae013f687e1f17ce5e45b704324109540c914ea163f75790ecae1f1a3d6e6e21cd718bfc5a90088dafe858eee6c71440b1fe613d792af9e30b6e01a758cab2be13",
		"0xe6769f71eb4168b55f6a1e0ae0c9e572c215f1b7bc3c283f11459bbe67f61bd06ae59085ef9bd77e6cc7247f387c5faa3218e3aa683407e2f27e7a36631841e8e96c676e2d9db8ffb17248d70689c2f45cde0ca27fa20b06bcf3b5020d9544e1d3acefc5200ae0a580d90e63ab1db7f742129411a95d513b568da33404528e536b756d781bd6e0e927a0e591666a32028bc3b72ee292dd444c54e6a6164dbb83eca54bffe0dd2664e9d3236f0e8f6135600e4570ad691cea0a6506df70a55b54",
	},
	{ // 2048-bit exponentiation odd-modulus
		"0x5c8fdc7fcf0a2de9b0855448af24e524050e298249d8acfd7ebf9ba8c10f11d1830c159229c72bab00bc38084c5505e41abc35d0357ad48baadab0a01bf359829462769dd4afb6c36021d045e73c188e25e25a781ba395a7299faf4dd73b20f71a9e923822e4952cf1164723bbaf2af2f07a7a466c19fe481a5640d1539352f90df7e47204e5ba2226d6b59688c6dba91b5032d45ea20df648902d9143502607bf87c47a244056d72a458fbceef751ac1c121aca99f2e221bb5869b81237a15e7cdf21247825415502a7ad5856ee5821051074eb5595de37d6826e7df43e2a5640d404078de62fedcd75e6d1dff62e407f6b0c96da26bddf289d0350af29836f",
		"0xa4d1ce5195ce776cc4d5d7f26bed09cc4d1273090ca3e2508e0fa941a0c638ab64f6c32815dc465e933db6861fcee1892da1fbf3fced3a8fce5ea5e3abbdc58085aa28e3ae965396c2f0dfa37cc5a4cfed3033a0e4f5122309bcff294837e519a4bd08e210e6cdb90ca0d422457f710f52eb01d639b40525d62ab19d694c487904ead31d5d174aea384998f034d43f8eef4873962f732f96f92a6b9411ea0aaa59e86e613633c6e11ae9440a57a0063579e6fc00fec63d24fb62678fc1d1f561d4d5483808820db505dedd3d81af0e56fb3576c416b7259af6963be24a2df225ed2f30ee186edeb8f3a3539f6c3fa609435eb2d899cc18ffb55796f88a4008fa",
		"0x7824aad0078b351d898492ce8ada3a277ff0939086686d09349aa0f9d57dc03b7c1e907e90f49e191260f4cab6b1b1e4e74948a5abbf61da9a20662cb80a5d7a2f2675d7900698bd685a3bfba9b4655fa8713ecec5565e20e63a8ebcb63cc3bf84817fdb3a6e62790d93a8070fcb70b4fd74aeef42f52ecdda018e6310fcc6a8d4ec4895a5a9585cb5363972a6d19f81d76a59508727a885d0c0449ee5b141083a00160892ea6802b63d9d6ad7f247da67aecf690983639b57419cafe570ed94b1275011af5bd82ce3d5e798079717dfaedabce4ec362a470f43e6c2fb5c859d62ccf4fcc9d9b3b90892328f0a07ed9eddf5e97b55d2e27b0a849c54af790c5d",
		"0x1a036bbe6991c899d4e7ec2e625505e5e8dcc5f794398b7ceff87d7218bb4720c92d506c0e57a92f1b00810580ed383a393a73edb3a0aa1d64a40e9b0f3a25729d463d6cd070387484b38da5aedfe234f5ea8e174efa6d3057d94e531ccc93595cfde5b55336a5cd7b4f81ac07da4375929b72dd180ee634eb07048cbf8314398edc4157db2ffba00c0d0ed8d158b25860452150a7262279d9dea7cb3c8d77b8825ef3270372219206d1add301af692dd1b150ae5e2233f8ffd56b3e9524308daeb181e24d8facbf97c5dde870e9384322c4c99582f05146a2af4f9a1c5c9248427ad82fa6b4b5f854d168357c7b6b9d09b0b8137cac432af2bde0d1c9f2314d",
	},
}

func TestFazExp(t *testing.T) {
	for i, test := range devel_expTests {
		x, ok1 := new(Int).SetString(test.x, 0)
		y, ok2 := new(Int).SetString(test.y, 0)
		out, ok3 := new(Int).SetString(test.out, 0)

		var ok4 bool
		var m *Int

		if len(test.m) == 0 {
			m, ok4 = nil, true
		} else {
			m, ok4 = new(Int).SetString(test.m, 0)
		}

		if !ok1 || !ok2 || !ok3 || !ok4 {
			t.Errorf("#%d: error in input", i)
			continue
		}

		z1 := new(Int).Exp(x, y, m)
		if !isNormalized(z1) {
			t.Errorf("#%d: %v is not normalized", i, *z1)
		}
		if z1.Cmp(out) != 0 {
			t.Errorf("#%d: got %x want %x", i, z1, out)
		}

		if m == nil {
			// The result should be the same as for m == 0;
			// specifically, there should be no div-zero panic.
			m = &Int{abs: nat{}} // m != nil && len(m.abs) == 0
			z2 := new(Int).Exp(x, y, m)
			if z2.Cmp(z1) != 0 {
				t.Errorf("#%d: got %x want %x", i, z2, z1)
			}
		}
	}
}
